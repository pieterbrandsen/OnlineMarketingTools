@page "/listpersons"
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using OnlineMarketingTools.Core.Entities
@inject PersonHttpRepository PersonHttpRepository
@inject IJSRuntime IJSRuntime
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthenticationStateProvider


<h3>
	Person List
</h3>
<AuthorizeView>
@if (persons is null)
{
	<p>Loading</p>
}
else if (persons.Count() is 0)
{
	<p>No Notes Found</p>
}
else if (persons is not null)
{
	<PersonTableComponent Persons="persons"></PersonTableComponent>
}
</AuthorizeView>

@code {
	private ICollection<PersonIntegrated> persons { get; set; }

	protected override async Task OnInitializedAsync()
	{
		var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
		var user = authState.User;

		try
		{
			persons = await PersonHttpRepository.GetAllAsync<PersonIntegrated>("api/person");
		}
		catch (AccessTokenNotAvailableException ex)
		{
			await IJSRuntime.InvokeAsync<bool>("confirm", $"{ex}");
			//ex.Redirect();
		}
	}
}